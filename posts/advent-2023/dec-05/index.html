<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://yamlscript.org/posts/advent-2023/dec-05/"><link href="/assets/main.7eeaf7bb0c5b5da98e70.css" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet"><title>Unwrapping Gifts | YAMLScript</title><link rel="icon" type="“image/x-icon”" href="/images/favicon.ico"><meta property="og:title" content="Unwrapping Gifts"><meta property="og:site_name" content="YAMLScript"><meta property="og:type" content="website"><meta property="og:url" content="https://yamlscript.org/posts/advent-2023/dec-05/"><meta name="twitter:card" content="summary_large_image"><meta name="description" content="Unwrapping Gifts 05 Dec 2023 | 4 min read It&#39;s certainly a relief now that I&#39;ve told you the big secret about YAMLScript. Now that you know..."><meta property="og:description" content="Unwrapping Gifts 05 Dec 2023 | 4 min read It&#39;s certainly a relief now that I&#39;ve told you the big secret about YAMLScript. Now that you know..."><meta name="description" content="Unwrapping Gifts 05 Dec 2023 | 4 min read It&#39;s certainly a relief now that I&#39;ve told you the big secret about YAMLScript. Now that you know..."><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:true});</script></head><body><div class="layout-wrapper"><header class="header"><div class="header__content"><h1 class="site-title"><a href="/"><img src="/images/yamlscript.svg"></a></h1><nav class="nav"><ul class="nav__list"><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="/about">About</a></li></ul></nav></div></header><main class="main"><article class="post"><header class="post__header"><h1>Unwrapping Gifts</h1><div class="post__details"><time datetime="2023-12-05">05 Dec 2023 </time><span>| </span><span>4 min read</span></div></header><main class="post__content"><p>It's certainly a relief now that I've told you the big secret about YAMLScript. Now that you know that YAMLScript is really Clojure, I don't have to dance around the subject anymore. I didn't want to scare you away by going Full-Lisp on you from the start!</p><p>Now we can just get into it. We can write, run and load YAMLScript until the cows come home.</p><p>But wait... How do we do that? You don't even have YS installed yet!</p><h3>Welcome to Day 5 of the YAMLScript Advent Calendar</h3><p>Today we're going to learn how to install YAMLScript a couple different ways.</p><p>Luckily for you I just finished creating the <a href="https://github.com/yaml/yamlscript/releases/tag/0.1.20">first official YAMLScript release</a>. What a coincidence!</p><p>At he moment there are only releases published for Linux x86_64 and macOS aarch64. If you happen to be running on one of those platforms, you can run the following command to install YAMLScript's CLI, <code>ys</code>:</p><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> https://yamlscript.org/install-ys <span class="token operator">|</span> <span class="token function">bash</span></code></pre><p>This installer defaults to installing <code>ys</code> into <code>/usr/local/bin</code> so you probably need to run it as root or with <code>sudo</code>:</p><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> https://yamlscript.org/install-ys <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">bash</span></code></pre><p>If you want to install it somewhere else, like say <code>~/local/bin</code>, you can do:</p><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> https://yamlscript.org/install-ys <span class="token operator">|</span> <span class="token assign-left variable">PREFIX</span><span class="token operator">=~</span>/local <span class="token function">bash</span></code></pre><p>Whereever you install it, make sure that the <code>$PREFIX/bin</code> directory is in your <code>PATH</code> environment variable.</p><p>YAMLScript also provides a release for <code>libyamlscript.so</code>, the YAMLScript shared library. You can install it like above but with (some variation of):</p><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> https://yamlscript.org/install-libyamlscript <span class="token operator">|</span> <span class="token function">bash</span></code></pre><p>We'll be using the shared library soon when we start playing around with using YAMLScript from other programming languages.</p><h3>Building from Source</h3><p>The most reliable way to install YAMLScript is to build it from source. We've put a lot of effort into making this as easy as possible. You don't need any special prerequisites; just git, bash, curl and make.</p><p>The first thing you need to do is clone the YAMLScript repo:</p><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/yaml/yamlscript</code></pre><p>Then you can build and install the CLI with:</p><pre class="language-bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> yamlscript<br>$ <span class="token function">make</span> build<br>$ <span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span><br>or<br>$ <span class="token function">make</span> <span class="token function">install</span> <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span><span class="token punctuation">..</span>.</code></pre><p>The <code>make install</code> command will install both <code>ys</code> and <code>libyamlscript.so</code> into <code>$PREFIX/bin</code> and <code>$PREFIX/lib</code> respectively.</p><blockquote><p>Note: Currently you should take care not to run <code>make build</code> as root. Since <code>make install</code> triggers <code>make build</code>, running <code>sudo make install</code> without first running <code>make build</code> may fail. This should be fixed soon.</p></blockquote><p>YAMLScript has a pretty sophisticated build system, built around GNU Make. Even though the build uses Java, Clojure and GraalVM, you don't need to install any of those things. In fact, even if you have them installed, the build will ignore them.</p><h3>Running YAMLScript</h3><p>Now that you have YAMLScript installed, you can run it. Try:</p><pre class="language-bash"><code class="language-bash">$ ys <span class="token parameter variable">--help</span></code></pre><p>It should display:</p><pre class="language-text"><code class="language-text">ys - The YAMLScript (YS) Command Line Tool<br><br>Usage: ys [options] [file]<br><br>Options:<br>  -r, --run                Compile and evaluate a YAMLScript file (default)<br>  -l, --load               Output the evaluated YAMLScript value<br>  -c, --compile            Compile YAMLScript to Clojure<br>  -e, --eval YSEXPR        Evaluate a YAMLScript expression<br>  -C, --clj                Treat input as Clojure code<br><br>  -m, --mode MODE          Add a mode tag: code, data, or bare (only for --eval/-e)<br>  -p, --print              Print the result of --run in code mode<br><br>  -o, --output             Output file for --load or --compile<br>  -t, --to FORMAT          Output format for --load<br><br>  -J, --json               Output JSON for --load<br>  -Y, --yaml               Output YAML for --load<br>  -E, --edn                Output EDN for --load<br><br>  -X, --debug              Debug mode: print full stack trace for errors<br>  -x, --debug-stage STAGE  Display the result of stage(s)<br>      --version            Print version and exit<br>  -h, --help               Print this help and exit</code></pre><p>In the next day or two we'll go over all of these options in detail.</p><p>Here's a quick example of how to run YAMLScript to process a file from the internet that Google just told me about:</p><pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> <span class="token parameter variable">-s</span> https://gist.githubusercontent.com/chriscowley/8598119/raw/8f671464f914320281e5e75bb8dcbe11285d21e6/nfs.example.lan.yml <span class="token operator">|</span><br>  ys <span class="token parameter variable">-J</span> <span class="token operator">|</span> jq .classes<br><span class="token punctuation">{</span><br>  <span class="token string">"nfs::server"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><br>    <span class="token string">"exports"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><br>      <span class="token string">"/srv/share1"</span>,<br>      <span class="token string">"/srv/share3"</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>When <code>ys</code> notices there is data on STDIN, it will read the YS program from there. The <code>-J</code> option tells <code>ys</code> to <code>--load</code> the YS and output the evaluation to JSON.</p><p>Well that's a wrap. Thanks again for following along each day.</p><p>I'll see you tomorrow for day 6 of YAMLScript Advent 2023!</p><p>&nbsp;</p><details><summary style="color:#888">Santa's little secrets...</summary><p>In December 2023 YAMLScript is a work in progress.</p><p>This is not to say that it's vaporware, or a toy proof of concept. It has a working compiler, runtime and CLI. It has unit tests that must pass for every commit pushed to the main branch. It's well thought out and has a clear direction that I continually vet with a small group of talented and trusted people.</p><p>But that in turn not to say that you should use it in production today. I encourage you to start playing with it, and I'm committed to backwards compatibility for stable releases. But we're not quite there yet. Caveat usor!</p><p>YAMLScript is evolving fast. While I'm writing these posts, I'm also writing the code for new features and fixing bugs as I go. I've had the Advent plan for over a month now, and I had planned to be further along before December 1st, but such are the time estimates of hackers.</p><p>I am attempting to make sure that the code examples in these posts are always using the implemented features, but sometimes I may fall a few hours behind. Often I need to write the examples using code patterns that actually work but are not the ones I preferred to best make a point.</p><p>As I fix bugs, implement features and tweak the language, I will update the posts accordingly. If you see something that bugs you, try taking another look after a few days. It probably bugged me too!</p><p>Be patient with me.</p><p>If I had to guess, I'd say that YAMLScript v0 will be have a stable release sometime before March 2024. I'll continue blogging the progress as I go, so it shouldn't be hard for you to decide when to start using YAMLScript for real.</p><p>Overall the whole thing is going extremely well, and I'm having a lot of fun. It's important to be transparent with you about where things are at.</p><p>Stick with me... This is going to be awesome!</p><p>— Ingy döt Net</p></details></main><aside class="post__aside"><div class="post__tags"><a href="/tags/blog/">#blog</a> <a href="/tags/advent-2023/">#advent-2023</a></div><nav class="post__pagination"><a href="/posts/advent-2023/dec-06/"><span>←</span> <span>Modes of Transportation</span> </a><a href="/posts/advent-2023/dec-04/"><span>Santa&#39;s Big Secret</span> <span>→</span></a></nav></aside></article></main><footer class="footer"><div class="footer__content"><ul class="hero__social-links"><li><a href="https://github.com/yaml/yamlscript" target="_blank" rel="noopener noreferrer">GitHub</a></li><li><a href="/feed.xml" target="_blank" rel="noopener noreferrer">RSS</a></li></ul><p class="footer__attribution">Powered by <a href="https://www.11ty.dev" target="_blank" rel="noopener">Eleventy</a>. Theme: <a href="https://github.com/yinkakun/eleventy-duo" target="_blank" rel="noopener noreferrer">Eleventy Duo</a>.</p></div></footer></div><script src="/assets/main.31d6cfe0d16ae931b73c.js"></script></body></html>